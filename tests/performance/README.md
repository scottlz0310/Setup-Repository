# パフォーマンステスト

このディレクトリには、Setup-Repositoryツールのパフォーマンステストが含まれています。

## テストの種類

### 1. 同期処理パフォーマンステスト (`test_sync_performance.py`)

- **小規模テスト**: 5リポジトリの同期処理（2秒以内）
- **中規模テスト**: 20リポジトリの同期処理（10秒以内）
- **大規模テスト**: 100リポジトリの同期処理（30秒以内）
- **並行処理テスト**: 並行同期処理の効率性検証
- **メモリ使用量テスト**: メモリリーク検出（50MB以下の増加）
- **起動時間テスト**: モジュールインポート時間（1秒以内）

## テスト実行方法

### 全パフォーマンステスト実行
```bash
uv run pytest tests/performance/ -v
```

### 特定のスケールのテスト実行
```bash
# 小規模テストのみ
uv run pytest tests/performance/ -m "performance and not slow" -v

# 中規模テストのみ
uv run pytest tests/performance/test_sync_performance.py::TestSyncPerformance::test_medium_repository_set_performance -v

# 大規模テスト（時間がかかります）
uv run pytest tests/performance/ -m "slow" -v
```

### 詳細なレポート付き実行
```bash
uv run pytest tests/performance/ -v --tb=short --durations=10
```

## パフォーマンス基準

| テスト種類 | 基準時間 | 説明 |
|-----------|---------|------|
| 小規模同期 | < 2秒 | 5リポジトリの処理 |
| 中規模同期 | < 10秒 | 20リポジトリの処理 |
| 大規模同期 | < 30秒 | 100リポジトリの処理 |
| 起動時間 | < 1秒 | モジュールインポート |
| メモリ使用量 | < 50MB増加 | 大量データ処理時 |

## CI/CDでの実行

GitHub Actionsでは以下のスケジュールで実行されます：

- **プッシュ時**: 中規模テストまで実行
- **プルリクエスト時**: 小規模・中規模テスト実行
- **毎日午前2時**: 全スケールのテスト実行
- **手動実行**: スケール選択可能

## トラブルシューティング

### テストが遅い場合
1. システムリソースの確認
2. 他のプロセスの影響確認
3. テスト環境の最適化

### メモリテストが失敗する場合
1. 他のアプリケーションを終了
2. Pythonのガベージコレクション確認
3. テストデータサイズの調整

### 並行処理テストが失敗する場合
1. CPUコア数の確認
2. スレッドプール設定の調整
3. システム負荷の確認

## 新しいパフォーマンステストの追加

1. `test_sync_performance.py`に新しいテストメソッドを追加
2. `@pytest.mark.performance`マーカーを付与
3. 時間のかかるテストには`@pytest.mark.slow`も追加
4. 適切なアサーション基準を設定
5. ドキュメントを更新
